---
title: Linux 系统故障排查，看这一篇就够了
author: Kubehan
type: post
date: 2020-07-13T09:34:08+08:00
url: /2639.html
Baidusubmit:
  - 1
views:
  - 2202
thumbnail:
  - https://www.kubehan.cn/wp-content/uploads/2020/07/frc-a9eb54f78b0ea4e9578808df07cc90d2.jpeg
baidu_record:
  - 1
categories:
  - Linux运维

---
<p style="text-align: right;" data-mpa-powered-by="yiban.io">
  <span style="color: rgb(136, 136, 136);font-size: 14px;">来源：https://www.jianshu.com/p/0bbac570fa4c</span>
</p><section powered-by="xiumi.us" style='margin-top: 10px;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;'> <section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"> <section style="padding-right: 0.5em;padding-left: 0.5em;max-width: 100%;display: inline-block;vertical-align: top;height: 2em;line-height: 2em;background-color: rgb(243, 243, 243);text-align: center;color: rgb(52, 73, 94);box-sizing: border-box !important;overflow-wrap: break-word !important;"> 

<p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">导读</strong>
</p></section> </section> </section> <section powered-by="xiumi.us" style='margin-bottom: 10px;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;'> <section style="padding-top: 10px;padding-bottom: 10px;max-width: 100%;display: inline-block;width: 677px;vertical-align: top;background-color: rgb(243, 243, 243);box-shadow: rgb(0, 0, 0) 0px 0px 0px;box-sizing: border-box !important;overflow-wrap: break-word !important;"> <section powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"> <section style="padding-right: 25px;padding-left: 25px;max-width: 100%;color: rgb(52, 73, 94);font-size: 13px;line-height: 2;box-sizing: border-box !important;overflow-wrap: break-word !important;"> 

<p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">
  <span style="font-size: 15px;letter-spacing: 0.544px;">有时候会遇到一些疑难杂症，并且监控插件并不能一眼立马发现问题的根源。这时候就需要登录服务器进一步深入分析问题的根源。那么分析问题需要有一定的技术经验积累，并且有些问题涉及到的领域非常广，才能定位到问题。所以，分析问题和踩坑是非常锻炼一个人的成长和提升自我能力。如果我们有一套好的分析工具，那将是事半功倍，能够帮助大家快速定位问题，节省大家很多时间做更深入的事情。<br /></span>
</p>



<span style="font-size: 15px;">本篇文章主要介绍各种问题定位的工具以及会结合案例分析问题。</span>



<span style="font-size: 15px;"><strong>分析问题的方法论：</strong></span>

<span style="font-size: 15px;">套用5W2H方法，可以提出性能分析的几个问题</span>

<ul class="list-paddingleft-2" style="list-style-type: disc;">
  <li style="font-size: 15px;">
    <p>
      <span style="font-size: 15px;">What-现象是什么样的</span>
    </p>
  </li>
  
  <li style="font-size: 15px;">
    <p>
      <span style="font-size: 15px;">When-什么时候发生</span>
    </p>
  </li>
  
  <li style="font-size: 15px;">
    <p>
      <span style="font-size: 15px;">Why-为什么会发生</span>
    </p>
  </li>
  
  <li style="font-size: 15px;">
    <p>
      <span style="font-size: 15px;">Where-哪个地方发生的问题</span>
    </p>
  </li>
  
  <li style="font-size: 15px;">
    <p>
      <span style="font-size: 15px;">How much-耗费了多少资源</span>
    </p>
  </li>
  
  <li style="font-size: 15px;">
    <p>
      <span style="font-size: 15px;">How to do-怎么解决问题</span>
    </p>
  </li>
</ul></section> </section> </section> </section> 

<p style="margin-top: 1.4em;margin-bottom: 0.3em;max-width: 100%;min-height: 1em;font-family: inherit;font-style: inherit;font-weight: inherit;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);border-width: 0px;border-style: initial;border-color: initial;outline: 0px;font-size: 18px;vertical-align: baseline;line-height: 1.6em;color: rgb(21, 162, 48);box-sizing: border-box !important;overflow-wrap: break-word !important;">
  <span title="收起" style="margin-right: 10px;padding: 1px 8px;max-width: 100%;font-size: 13px;color: rgb(255, 255, 255);display: inline-block;line-height: 20px;background: rgb(92, 194, 111);cursor: pointer;box-sizing: border-box !important;overflow-wrap: break-word !important;">目录[-]</span>
</p>

<h1 style='max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="font-size: 15px;"><strong><span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">1、CPU</span></strong></span>
</h1>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="font-size: 15px;"><strong><span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">2、内存</span></strong></span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="font-size: 15px;"><strong><span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">3、磁盘IO</span></strong></span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="font-size: 15px;"><strong><span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">4、网络</span></strong></span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="font-size: 15px;"><strong><span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">5、系统负载</span></strong></span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="font-size: 15px;"><strong><span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">6、火焰图</span></strong></span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="font-size: 15px;"><strong><span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">7、案例分析</span></strong></span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br /></span>
</p>

<h3 style="line-height: 3em;">
  <span style="font-size: 20px;color: rgb(255, 104, 39);"><strong>1、CPU</strong></span><br />
</h3>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">1.1 说明</span><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" /><br />
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">针对应用程序，我们通常关注的是内核CPU调度器功能和性能。</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">线程的状态分析主要是分析线程的时间用在什么地方，而线程状态的分类一般分为：</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">a. on-CPU：执行中，执行中的时间通常又分为用户态时间user和系统态时间sys。<br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />b. off-CPU：等待下一轮上CPU，或者等待I/O、锁、换页等等，其状态可以细分为可执行、匿名换页、睡眠、锁、空闲等状态。</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">如果大量时间花在CPU上，对CPU的剖析能够迅速解释原因；如果系统时间大量处于off-cpu状态，定位问题就会费时很多。但是仍然需要清楚一些概念：</span>
</p>

<ul class="list-paddingleft-2" style='max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;'>
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">处理器</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">核</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">硬件线程</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">CPU内存缓存</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">时钟频率</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">每指令周期数CPI和每周期指令数IPC</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">CPU指令</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">使用率</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">用户时间／内核时间</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">调度器</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">运行队列</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">抢占</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">多进程</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">多线程</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">字长</span>
    </p>
  </li>
</ul>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">1.2 分析工具</span>
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-c11a9a7e1513f30e520bff00d4ccabe5.jpeg" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">说明：</span>
</p>

<ul class="list-paddingleft-2" style='max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;'>
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">uptime,vmstat,mpstat,top,pidstat只能查询到cpu及负载的的使用情况。</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">perf可以跟着到进程内部具体函数耗时情况，并且可以指定内核函数进行统计，指哪打哪。</span>
    </p>
  </li>
</ul>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">1.3 使用方式</span>
</h3>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//查看系统cpu使用情况&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">top&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//查看所有cpu核信息&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">mpstat -P ALL &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">1&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//查看cpu使用情况以及平均负载&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">vmstat &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">1&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//进程cpu的统计信息&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">pidstat -u &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">1&lt;/span> -p pid&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//跟踪进程内部函数级cpu使用情况&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">perf top -p pid -e cpu-clock</code></pre>

### 

<h3 style="line-height: 3em;">
  <span style="font-size: 20px;color: rgb(255, 104, 39);"><strong>2、内存</strong></span>
</h3>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">2.1 说明</span><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" /><br />
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">内存是为提高效率而生，实际分析问题的时候，内存出现问题可能不只是影响性能，而是影响服务或者引起其他问题。同样对于内存有些概念需要清楚：</span>
</p>

<ul class="list-paddingleft-2" style='max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;'>
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">主存</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">虚拟内存</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">常驻内存</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">地址空间</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">OOM</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">页缓存</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">缺页</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">换页</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">交换空间</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">交换</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">用户分配器libc、glibc、libmalloc和mtmalloc</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">LINUX内核级SLUB分配器</span>
    </p>
  </li>
</ul>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">2.2 分析工具</span>
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-c5f1a73fa4a09eb5f3808104760baa56.jpeg" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;color: rgb(0, 0, 0);box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">说明：</strong></span>
</p>

<ul class="list-paddingleft-2" style='max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;'>
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">free,vmstat,top,pidstat,pmap只能统计内存信息以及进程的内存使用情况。</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">valgrind可以分析内存泄漏问题。</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">dtrace动态跟踪。需要对内核函数有很深入的了解，通过D语言编写脚本完成跟踪。</span>
    </p>
  </li>
</ul>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">2.3 使用方式</span>
</h3>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//查看系统内存使用情况&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">free&lt;/span> -m&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//虚拟内存统计信息&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">vmstat &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">1&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//查看系统内存情况&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">top&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//1s采集周期，获取内存的统计信息&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">pidstat -p pid -r &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">1&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//查看进程的内存映像信息&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">pmap -d pid&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//检测程序内存问题&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">valgrind --tool=memcheck --leak-check=full --&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">log&lt;/span>-file=./&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">log&lt;/span>.txt  ./程序名&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></code></pre>

### 

<h3 style="line-height: 3em;">
  <span style="font-size: 20px;color: rgb(255, 104, 39);"><strong>3、磁盘IO</strong></span>
</h3>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">3.1 说明</span><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" /><br />
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">磁盘通常是计算机最慢的子系统，也是最容易出现性能瓶颈的地方，因为磁盘离 CPU 距离最远而且 CPU 访问磁盘要涉及到机械操作，比如转轴、寻轨等。访问硬盘和访问内存之间的速度差别是以数量级来计算的，就像1天和1分钟的差别一样。要监测 IO 性能，有必要了解一下基本原理和 Linux 是如何处理硬盘和内存之间的 IO 的。</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">在理解磁盘IO之前，同样我们需要理解一些概念，例如：</span>
</p>

<ul class="list-paddingleft-2" style='max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;'>
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">文件系统</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">VFS</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">文件系统缓存</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">页缓存page cache</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">缓冲区高速缓存buffer cache</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">目录缓存</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">inode</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">inode缓存</span>
    </p>
  </li>
  
  <li style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">
    <p style="max-width: 100%;min-height: 1em;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">
      <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">noop调用策略</span>
    </p>
  </li>
</ul>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">3.2 分析工具</span>
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-e7b71c4c03305bca124f9b89779a2fd3.png" />
</p>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">3.3 使用方式</span>
</h3>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//查看系统io信息&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">iotop&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//统计io详细信息&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">iostat -d -x -k &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">1&lt;/span> &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">10&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//查看进程级io的信息&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">pidstat -d &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">1&lt;/span> -p  pid&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//查看系统IO的请求，比如可以在发现系统IO异常时，可以使用该命令进行调查，就能指定到底是什么原因导致的IO异常&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">perf &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">record&lt;/span> -e block:block_rq_issue -ag&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">^C&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">perf report</code></pre>

<h3 style="line-height: 3em;">
</h3>

### 

<h3 style="line-height: 3em;">
  <span style="font-size: 20px;color: rgb(255, 104, 39);"><strong>4、网络</strong></span>
</h3>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">4.1 说明</span>
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">网络的监测是所有 Linux 子系统里面最复杂的，有太多的因素在里面，比如：延迟、阻塞、冲突、丢包等，更糟的是与 Linux 主机相连的路由器、交换机、无线信号都会影响到整体网络并且很难判断是因为 Linux 网络子系统的问题还是别的设备的问题，增加了监测和判断的复杂度。现在我们使用的所有网卡都称为自适应网卡，意思是说能根据网络上的不同网络设备导致的不同网络速度和工作模式进行自动调整。</span>
</p>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">4.2 分析工具</span>
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-8bde06f9d09030a63f250aa86013941e.jpeg" />
</p>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">4.3 使用方式</span>
</h3>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//显示网络统计信息&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">netstat -s&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//显示当前UDP连接状况&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">netstat -nu&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//显示UDP端口号的使用情况&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">netstat -apu&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//统计机器中网络连接各个状态个数&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">netstat -a | awk &lt;span style="max-width: 100%;font-size: inherit;color: rgb(238, 220, 112);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">\'/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}\'&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//显示TCP连接&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">ss -t -a&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//显示sockets摘要信息&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">ss -s&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//显示所有udp sockets&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">ss -u -a&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//tcp,etcp状态&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">sar -n TCP,ETCP &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">1&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//查看网络IO&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">sar -n DEV &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">1&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//抓包以包为单位进行输出&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">tcpdump -i eth1 host &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">192.168.1.1&lt;/span> &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">and&lt;/span> port &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">80&lt;/span> &lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//抓包以流为单位显示数据内容&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">tcpflow -cp host &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">192.168.1.1&lt;/span></code></pre>

### 

<h3 style="line-height: 3em;">
  <span style="font-size: 20px;color: rgb(255, 104, 39);"><strong>5、系统负载</strong></span>
</h3>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">5.1 说明</span><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" /><br />
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">Load 就是对计算机干活多少的度量（WikiPedia：the system Load is a measure of the amount of work that a compute system is doing）简单的说是进程队列的长度。Load Average 就是一段时间（1分钟、5分钟、15分钟）内平均Load。</span>
</p>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">5.2 分析工具</span>
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-488c00846afce146aff196b8b8aafb82.png" />
</p>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">5.3 使用方式</span>
</h3>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//查看负载情况&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">uptime&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">top&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">vmstat&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//统计系统调用耗时情况&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">strace -c -p pid&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//跟踪指定的系统操作例如epoll_wait&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">strace -T -e epoll_wait -p pid&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//查看内核日志信息&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">dmesg</code></pre>

### 

### 

<h3 style="line-height: 3em;">
  <span style="font-size: 20px;color: rgb(255, 104, 39);"><strong>6、火焰图</strong></span>
</h3>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">6.1 说明</span><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" /><br />
</h3>

<p style='margin-bottom: 10px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">火焰图（Flame Graph是 Bredan Gregg 创建的一种性能分析图表，因为它的样子近似 ?而得名。</span>
</p>

<p style='margin-bottom: 10px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">火焰图主要是用来展示 CPU的调用栈。</span>
</p>

<p style='margin-bottom: 10px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">y 轴表示调用栈，每一层都是一个函数。调用栈越深，火焰就越高，顶部就是正在执行的函数，下方都是它的父函数。</span>
</p>

<p style='margin-bottom: 10px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">x 轴表示抽样数，如果一个函数在 x 轴占据的宽度越宽，就表示它被抽到的次数多，即执行的时间长。注意，x 轴不代表时间，而是所有的调用栈合并后，按字母顺序排列的。</span>
</p>

<p style='margin-bottom: 10px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">火焰图就是看顶层的哪个函数占据的宽度最大。只要有”平顶”（plateaus），就表示该函数可能存在性能问题。颜色没有特殊含义，因为火焰图表示的是 CPU 的繁忙程度，所以一般选择暖色调。</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">常见的火焰图类型有On-CPU、Off-CPU、Memory、Hot/Cold、Differential等等。</span>
</p>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">6.2 安装依赖库</span>
</h3>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">//安装systemtap，默认系统已安装&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">yum &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">install&lt;/span> systemtap systemtap-runtime&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//内核调试库必须跟内核版本对应，例如：uname -r &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">2.6.18-308.&lt;/span>el5&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">kernel-debuginfo&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">-2.6.18-308.&lt;/span>el5.x86_64.rpm&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">kernel-devel&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">-2.6.18-308.&lt;/span>el5.x86_64.rpm&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">kernel-debuginfo-common&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">-2.6.18-308.&lt;/span>el5.x86_64.rpm&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//安装内核调试库&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">debuginfo-&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">install&lt;/span> &lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">--enablerepo=debuginfo search kernel&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">debuginfo-&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">install&lt;/span> &lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">--enablerepo=debuginfo  search glibc&lt;/span>&lt;br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></code></pre>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">6.3 安装</span>
</h3>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">git &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">clone&lt;/span> https://github.com/lidaohang/quick_location.git&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">cd&lt;/span> quick_location</code></pre>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">6.4 CPU级别火焰图</span>
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  cpu占用过高，或者使用率提不上来，你能快速定位到代码的哪块有问题吗？<br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />一般的做法可能就是通过日志等方式去确定问题。现在我们有了火焰图，能够非常清晰的发现哪个函数占用cpu过高，或者过低导致的问题。
</p>

<h4 style='max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">6.4.1 on-CPU</strong></span>
</h4>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">cpu占用过高，执行中的时间通常又分为用户态时间user和系统态时间sys。</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">使用方式：</span></strong>
</p>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//on-CPU user&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">sh ngx_on_cpu_u.sh pid&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//进入结果目录&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">cd ngx_on_cpu_u&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//on-CPU kernel&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">sh ngx_on_cpu_k.sh pid&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//进入结果目录&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">cd ngx_on_cpu_k&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//开一个临时端口8088&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">python -m SimpleHTTPServer &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">8088&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//打开浏览器输入地址&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">127.0.0.1&lt;/span>:&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">8088&lt;/span>/pid.svg</code></pre>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">DEMO：</span></strong>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(91, 218, 237);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">#&lt;span style="max-width: 100%;line-height: inherit;">include&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">&lt;stdio.h>&lt;/stdio.h>&lt;/span>&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(91, 218, 237);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">#&lt;span style="max-width: 100%;line-height: inherit;">include&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">&lt;stdlib.h>&lt;/stdlib.h>&lt;/span>&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">void&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">foo3()&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">void&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">foo2()&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">int&lt;/span> i;&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">for&lt;/span>(i=&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">0&lt;/span> ; i 10; i++)&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">       foo3();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">void&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">foo1()&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">int&lt;/span> i;&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">for&lt;/span>(i = &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">0&lt;/span>; i1000; i++)&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">     foo3();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">int&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">main(&lt;span style="max-width: 100%;font-size: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">void&lt;/span>)&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">int&lt;/span> i;&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">for&lt;/span>( i =&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">0&lt;/span>; i1000000000; i++) {&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">      foo1();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">      foo2();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  }&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}&lt;br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></code></pre>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">DEMO火焰图：</span></strong>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br /></span></strong>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;padding: 0px 0.5em;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-79d781d6d02b3a4fa04cd25704e46c8f.jpeg" />
</p>

<h4 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">6.4.2 off-CPU</span>
</h4>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">cpu过低，利用率不高。等待下一轮CPU，或者等待I/O、锁、换页等等，其状态可以细分为可执行、匿名换页、睡眠、锁、空闲等状态。</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">使用方式：</span></strong>
</p>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">// off-CPU user&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">sh ngx_off_cpu_u.sh pid&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//进入结果目录&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">cd ngx_off_cpu_u&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//off-CPU kernel&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">sh ngx_off_cpu_k.sh pid&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//进入结果目录&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">cd ngx_off_cpu_k&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//开一个临时端口8088&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">python -m SimpleHTTPServer &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">8088&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//打开浏览器输入地址&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">127.0.0.1&lt;/span>:&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">8088&lt;/span>/pid.svg</code></pre>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">官网DEMO：</strong></span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;padding: 0px 0.5em;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-d8c067a819ec6b1d1d5b261bd489a1c7.jpeg" />
</p>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">6.5 内存级别火焰图</span>
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">如果线上程序出现了内存泄漏，并且只在特定的场景才会出现。这个时候我们怎么办呢？有什么好的方式和工具能快速的发现代码的问题呢？同样内存级别火焰图帮你快速分析问题的根源。</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">使用方式：</span></strong>
</p>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">sh ngx_on_memory.sh pid&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//进入结果目录&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">cd ngx_on_memory&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//开一个临时端口8088&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">python -m SimpleHTTPServer &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">8088&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//打开浏览器输入地址&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">127.0.0.1&lt;/span>:&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">8088&lt;/span>/pid.svg</code></pre>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">官网DEMO：</strong></span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;padding: 0px 0.5em;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-a982444116a0814572c0b6063170e506.jpeg" />
</p>

<h2 style='max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">6.6 性能回退-红蓝差分火焰图</strong></span>
</h2>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<h2 style='max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">你能快速定位CPU性能回退的问题么？如果你的工作环境非常复杂且变化快速，那么使用现有的工具是来定位这类问题是很具有挑战性的。当你花掉数周时间把根因找到时，代码已经又变更了好几轮，新的性能问题又冒了出来。主要可以用到每次构建中，每次上线做对比看，如果损失严重可以立马解决修复。</span>
</h2>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">通过抓取了两张普通的火焰图，然后进行对比，并对差异部分进行标色：红色表示上升，蓝色表示下降。差分火焰图是以当前（“修改后”）的profile文件作为基准，形状和大小都保持不变。因此你通过色彩的差异就能够很直观的找到差异部分，且可以看出为什么会有这样的差异。</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">使用方式：</span></strong>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">cd quick_location&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//抓取代码修改前的profile 1文件&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">perf record -F &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">99&lt;/span> -p pid -g -- sleep &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">30&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">perf script &gt; &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">out&lt;/span>.stacks1&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//抓取代码修改后的profile 2文件&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">perf record -F &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">99&lt;/span> -p pid -g -- sleep &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">30&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">perf script &gt; &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">out&lt;/span>.stacks2&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//生成差分火焰图:&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">./FlameGraph/stackcollapse-perf.pl ../&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">out&lt;/span>.stacks1 &gt; &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">out&lt;/span>.folded1&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">./FlameGraph/stackcollapse-perf.pl ../&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">out&lt;/span>.stacks2 &gt; &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">out&lt;/span>.folded2&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">./FlameGraph/difffolded.pl &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">out&lt;/span>.folded1 &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">out&lt;/span>.folded2 | ./FlameGraph/flamegraph.pl &gt; diff2.svg</code></pre>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">DEMO：</strong></span>
</p>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//test.c&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(91, 218, 237);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">#&lt;span style="max-width: 100%;line-height: inherit;">include&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">&lt;stdio.h>&lt;/stdio.h>&lt;/span>&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(91, 218, 237);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">#&lt;span style="max-width: 100%;line-height: inherit;">include&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">&lt;stdlib.h>&lt;/stdlib.h>&lt;/span>&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">void&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">foo3()&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">void&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">foo2()&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">int&lt;/span> i;&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">for&lt;/span>(i=&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">0&lt;/span> ; i 10; i++)&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">       foo3();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">void&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">foo1()&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">int&lt;/span> i;&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">for&lt;/span>(i = &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">0&lt;/span>; i1000; i++)&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">     foo3();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">int&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">main(&lt;span style="max-width: 100%;font-size: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">void&lt;/span>)&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">int&lt;/span> i;&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">for&lt;/span>( i =&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">0&lt;/span>; i1000000000; i++) {&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">      foo1();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">      foo2();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  }&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//test1.c&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(91, 218, 237);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">#&lt;span style="max-width: 100%;line-height: inherit;">include&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">&lt;stdio.h>&lt;/stdio.h>&lt;/span>&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(91, 218, 237);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">#&lt;span style="max-width: 100%;line-height: inherit;">include&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">&lt;stdlib.h>&lt;/stdlib.h>&lt;/span>&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">void&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">foo3()&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">void&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">foo2()&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">int&lt;/span> i;&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">for&lt;/span>(i=&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">0&lt;/span> ; i 10; i++)&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">       foo3();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">void&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">foo1()&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">int&lt;/span> i;&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">for&lt;/span>(i = &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">0&lt;/span>; i1000; i++)&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">     foo3();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">void&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">add()&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">int&lt;/span> i;&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">for&lt;/span>(i = &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">0&lt;/span>; i10000; i++)&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">     foo3();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;">int&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">main(&lt;span style="max-width: 100%;font-size: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">void&lt;/span>)&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;/span>{&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">int&lt;/span> i;&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  &lt;span style="max-width: 100%;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">for&lt;/span>( i =&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">0&lt;/span>; i1000000000; i++) {&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">      foo1();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">      foo2();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">      add();&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">  }&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">}</code></pre>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">DEMO红蓝差分火焰图：</strong></span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;padding: 0px 0.5em;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-48dde8fbba8a7fbc290e0f8e3743ac40.jpeg" />
</p>

<h3 style="line-height: 3em;">
  <span style="font-size: 20px;color: rgb(255, 104, 39);"><strong>7、案例分析</strong></span>
</h3>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">7.1 接入层nginx集群异常现象</span><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" /><br />
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">通过监控插件发现在2017.09.25 19点nginx集群请求流量出现大量的499，5xx状态码。并且发现机器cpu使用率升高，目前一直持续中。</span>
</p>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">7.2 分析nginx相关指标</span></strong></span>
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">a) 分析nginx请求流量：</span></strong>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;padding: 0px 0.5em;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-bf6affa5def247d5eda5f0c0f8421220.jpeg" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">结论：</strong></span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">通过上图发现流量并没有突增，反而下降了，跟请求流量突增没关系。</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;letter-spacing: 0.544px;text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">b) 分析nginx响应时间</span></strong>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;padding: 0px 0.5em;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-43f4ba30ad1ddba3dd7d8f76f9029502.jpeg" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">结论：</span></strong>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">通过上图发现nginx的响应时间有增加可能跟nginx自身有关系或者跟后端upstream响应时间有关系。</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">c) 分析nginx upstream响应时间</span></strong>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;padding: 0px 0.5em;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-10b19589e5671b426b84a98d83a3d27e.jpeg" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">结论：</span></strong>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">通过上图发现nginx upstream 响应时间有增加，目前猜测可能后端upstream响应时间拖住nginx，导致nginx出现请求流量异常。</span>
</p>

<h3 style='max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">7.3 分析系统cpu情况</span></strong>
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">a) 通过top观察系统指标</span></strong>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <code style="margin-right: 0.15em;margin-left: 0.15em;padding-right: 0.3em;padding-left: 0.3em;max-width: 100%;font-size: 0.85em;font-family: Consolas, Inconsolata, Courier, monospace;white-space: pre-wrap;border-width: 1px;border-style: solid;border-color: rgb(234, 234, 234);background-color: rgb(248, 248, 248);border-radius: 3px;display: inline;box-sizing: border-box !important;overflow-wrap: break-word !important;">&lt;span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">top&lt;/span></code>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);padding: 0px 0.5em;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-9512dc98964ade768a1235669fd12aaa.jpeg" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">结论：</strong></span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">发现nginx worker cpu比较高</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">b) 分析nginx进程内部cpu情况</span></strong>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <code style="margin-right: 0.15em;margin-left: 0.15em;padding-right: 0.3em;padding-left: 0.3em;max-width: 100%;font-size: 0.85em;font-family: Consolas, Inconsolata, Courier, monospace;white-space: pre-wrap;border-width: 1px;border-style: solid;border-color: rgb(234, 234, 234);background-color: rgb(248, 248, 248);border-radius: 3px;display: inline;box-sizing: border-box !important;overflow-wrap: break-word !important;">&lt;span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">perf top -p pid&lt;/span></code>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <code style="margin-right: 0.15em;margin-left: 0.15em;padding-right: 0.3em;padding-left: 0.3em;max-width: 100%;font-size: 0.85em;font-family: Consolas, Inconsolata, Courier, monospace;white-space: pre-wrap;border-width: 1px;border-style: solid;border-color: rgb(234, 234, 234);background-color: rgb(248, 248, 248);border-radius: 3px;display: inline;box-sizing: border-box !important;overflow-wrap: break-word !important;">&lt;span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;padding: 0px 0.5em;">&lt;img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-49960ae4b44a9a2641b511664c5c59f6.jpeg">&lt;/span></code>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">结论：</span></strong>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">发现主要开销在free,malloc,json解析上面</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">7.4 火焰图分析cpu</span></strong><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" /><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" /><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">a) 生成用户态cpu火焰图</strong></span>
</p>

<pre style="max-width: 100%;letter-spacing: 0.544px;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 0.5em;max-width: 100%;font-size: 12px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//test.c&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(91, 218, 237);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">#&lt;span style="max-width: 100%;line-height: inherit;">include&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">&lt;stdio.h>&lt;/stdio.h>&lt;/span>&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(91, 218, 237);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">#&lt;span style="max-width: 100%;line-height: inherit;">include&lt;/span> &lt;span style="max-width: 100%;line-height: inherit;">&lt;stdlib.h>&lt;/stdlib.h>&lt;/span>&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//on-CPU user&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">sh ngx_on_cpu_u.sh pid&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//进入结果目录&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">cd ngx_on_cpu_u&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//开一个临时端口8088&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">python -m SimpleHTTPServer &lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">8088&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">//打开浏览器输入地址&lt;/span>&lt;br style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">127.0.0.1&lt;/span>:&lt;span style="max-width: 100%;font-size: inherit;color: rgb(174, 135, 250);line-height: inherit;box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">8088&lt;/span>/pid.svg</code></pre>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;padding: 0px 0.5em;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <img decoding="async" src="https://www.kubehan.cn/wp-content/uploads/2020/07/frc-a9eb54f78b0ea4e9578808df07cc90d2.jpeg" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;color: rgb(68, 68, 68);font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">结论：</strong></span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;" />
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">发现代码里面有频繁的解析json操作，并且发现这个json库性能不高，占用cpu挺高。</span>
</p>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 16px;color: rgb(171, 25, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">7.5 案例总结</span>
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">a) </strong>分析请求流量异常，得出nginx upstream后端机器响应时间拉长</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">b) </strong>分析nginx进程cpu高，得出nginx内部模块代码有耗时的json解析以及内存分配回收操作</span>
</p>

<h4 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">7.5.1 深入分析</span>
</h4>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">根据以上两点问题分析的结论，我们进一步深入分析。</span>
</p>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">后端upstream响应拉长，最多可能影响nginx的处理能力。但是不可能会影响nginx内部模块占用过多的cpu操作。并且当时占用cpu高的模块，是在请求的时候才会走的逻辑。不太可能是upstram后端拖住nginx，从而触发这个cpu的耗时操作。</span>
</p>

<h3 style='margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">7.5.2 解决方式</span>
</h3>

<p style='max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;margin-bottom: 1.2em !important;box-sizing: border-box !important;overflow-wrap: break-word !important;'>
  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">遇到这种问题，我们优先解决已知的，并且非常明确的问题。那就是cpu高的问题。解决方式先降级关闭占用cpu过高的模块，然后进行观察。经过降级关闭该模块cpu降下来了，并且nginx请求流量也正常了。之所以会影响upstream时间拉长，因为upstream后端的服务调用的接口可能是个环路再次走回到nginx。</p>